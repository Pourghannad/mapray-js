!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@mapray/mapray-js")):"function"==typeof define&&define.amd?define(["@mapray/mapray-js"],t):(e=e||self).maprayui=t(e.mapray)}(this,(function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e,t){return e(t={exports:{}},t.exports),t.exports}var n=function(e){return e&&e.Math==Math&&e},a=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||Function("return this")(),i=function(e){try{return!!e()}catch(e){return!0}},o=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),s={}.propertyIsEnumerable,c=Object.getOwnPropertyDescriptor,u={f:c&&!s.call({1:2},1)?function(e){var t=c(this,e);return!!t&&t.enumerable}:s},l=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},h={}.toString,_=function(e){return h.call(e).slice(8,-1)},f="".split,p=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==_(e)?f.call(e,""):Object(e)}:Object,d=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},v=function(e){return p(d(e))},m=function(e){return"object"==typeof e?null!==e:"function"==typeof e},g=function(e,t){if(!m(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!m(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!m(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!m(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")},y={}.hasOwnProperty,w=function(e,t){return y.call(e,t)},E=a.document,M=m(E)&&m(E.createElement),b=function(e){return M?E.createElement(e):{}},A=!o&&!i((function(){return 7!=Object.defineProperty(b("div"),"a",{get:function(){return 7}}).a})),x=Object.getOwnPropertyDescriptor,R={f:o?x:function(e,t){if(e=v(e),t=g(t,!0),A)try{return x(e,t)}catch(e){}if(w(e,t))return l(!u.f.call(e,t),e[t])}},T=function(e){if(!m(e))throw TypeError(String(e)+" is not an object");return e},O=Object.defineProperty,k={f:o?O:function(e,t,r){if(T(e),t=g(t,!0),T(r),A)try{return O(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},L=o?function(e,t,r){return k.f(e,t,l(1,r))}:function(e,t,r){return e[t]=r,e},P=function(e,t){try{L(a,e,t)}catch(r){a[e]=t}return t},S=a["__core-js_shared__"]||P("__core-js_shared__",{}),C=Function.toString;"function"!=typeof S.inspectSource&&(S.inspectSource=function(e){return C.call(e)});var F,N,I,j=S.inspectSource,G=a.WeakMap,V="function"==typeof G&&/native code/.test(j(G)),U=r((function(e){(e.exports=function(e,t){return S[e]||(S[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.4",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})})),D=0,H=Math.random(),K=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++D+H).toString(36)},z=U("keys"),B=function(e){return z[e]||(z[e]=K(e))},Y={},$=a.WeakMap;if(V){var W=new $,q=W.get,X=W.has,Z=W.set;F=function(e,t){return Z.call(W,e,t),t},N=function(e){return q.call(W,e)||{}},I=function(e){return X.call(W,e)}}else{var J=B("state");Y[J]=!0,F=function(e,t){return L(e,J,t),t},N=function(e){return w(e,J)?e[J]:{}},I=function(e){return w(e,J)}}var Q,ee,te={set:F,get:N,has:I,enforce:function(e){return I(e)?N(e):F(e,{})},getterFor:function(e){return function(t){var r;if(!m(t)||(r=N(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}},re=r((function(e){var t=te.get,r=te.enforce,n=String(String).split("String");(e.exports=function(e,t,i,o){var s=!!o&&!!o.unsafe,c=!!o&&!!o.enumerable,u=!!o&&!!o.noTargetGet;"function"==typeof i&&("string"!=typeof t||w(i,"name")||L(i,"name",t),r(i).source=n.join("string"==typeof t?t:"")),e!==a?(s?!u&&e[t]&&(c=!0):delete e[t],c?e[t]=i:L(e,t,i)):c?e[t]=i:P(t,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||j(this)}))})),ne=a,ae=function(e){return"function"==typeof e?e:void 0},ie=function(e,t){return arguments.length<2?ae(ne[e])||ae(a[e]):ne[e]&&ne[e][t]||a[e]&&a[e][t]},oe=Math.ceil,se=Math.floor,ce=function(e){return isNaN(e=+e)?0:(e>0?se:oe)(e)},ue=Math.min,le=function(e){return e>0?ue(ce(e),9007199254740991):0},he=Math.max,_e=Math.min,fe=function(e,t){var r=ce(e);return r<0?he(r+t,0):_e(r,t)},pe=function(e){return function(t,r,n){var a,i=v(t),o=le(i.length),s=fe(n,o);if(e&&r!=r){for(;o>s;)if((a=i[s++])!=a)return!0}else for(;o>s;s++)if((e||s in i)&&i[s]===r)return e||s||0;return!e&&-1}},de={includes:pe(!0),indexOf:pe(!1)}.indexOf,ve=function(e,t){var r,n=v(e),a=0,i=[];for(r in n)!w(Y,r)&&w(n,r)&&i.push(r);for(;t.length>a;)w(n,r=t[a++])&&(~de(i,r)||i.push(r));return i},me=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ge=me.concat("length","prototype"),ye={f:Object.getOwnPropertyNames||function(e){return ve(e,ge)}},we={f:Object.getOwnPropertySymbols},Ee=ie("Reflect","ownKeys")||function(e){var t=ye.f(T(e)),r=we.f;return r?t.concat(r(e)):t},Me=function(e,t){for(var r=Ee(t),n=k.f,a=R.f,i=0;i<r.length;i++){var o=r[i];w(e,o)||n(e,o,a(t,o))}},be=/#|\.prototype\./,Ae=function(e,t){var r=Re[xe(e)];return r==Oe||r!=Te&&("function"==typeof t?i(t):!!t)},xe=Ae.normalize=function(e){return String(e).replace(be,".").toLowerCase()},Re=Ae.data={},Te=Ae.NATIVE="N",Oe=Ae.POLYFILL="P",ke=Ae,Le=R.f,Pe=function(e,t){var r,n,i,o,s,c=e.target,u=e.global,l=e.stat;if(r=u?a:l?a[c]||P(c,{}):(a[c]||{}).prototype)for(n in t){if(o=t[n],i=e.noTargetGet?(s=Le(r,n))&&s.value:r[n],!ke(u?n:c+(l?".":"#")+n,e.forced)&&void 0!==i){if(typeof o==typeof i)continue;Me(o,i)}(e.sham||i&&i.sham)&&L(o,"sham",!0),re(r,n,o,e)}},Se=Array.isArray||function(e){return"Array"==_(e)},Ce=function(e){return Object(d(e))},Fe=function(e,t,r){var n=g(t);n in e?k.f(e,n,l(0,r)):e[n]=r},Ne=!!Object.getOwnPropertySymbols&&!i((function(){return!String(Symbol())})),Ie=Ne&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,je=U("wks"),Ge=a.Symbol,Ve=Ie?Ge:Ge&&Ge.withoutSetter||K,Ue=function(e){return w(je,e)||(Ne&&w(Ge,e)?je[e]=Ge[e]:je[e]=Ve("Symbol."+e)),je[e]},De=Ue("species"),He=function(e,t){var r;return Se(e)&&("function"!=typeof(r=e.constructor)||r!==Array&&!Se(r.prototype)?m(r)&&null===(r=r[De])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===t?0:t)},Ke=ie("navigator","userAgent")||"",ze=a.process,Be=ze&&ze.versions,Ye=Be&&Be.v8;Ye?ee=(Q=Ye.split("."))[0]+Q[1]:Ke&&(!(Q=Ke.match(/Edge\/(\d+)/))||Q[1]>=74)&&(Q=Ke.match(/Chrome\/(\d+)/))&&(ee=Q[1]);var $e=ee&&+ee,We=Ue("species"),qe=function(e){return $e>=51||!i((function(){var t=[];return(t.constructor={})[We]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Xe=Ue("isConcatSpreadable"),Ze=$e>=51||!i((function(){var e=[];return e[Xe]=!1,e.concat()[0]!==e})),Je=qe("concat"),Qe=function(e){if(!m(e))return!1;var t=e[Xe];return void 0!==t?!!t:Se(e)};Pe({target:"Array",proto:!0,forced:!Ze||!Je},{concat:function(e){var t,r,n,a,i,o=Ce(this),s=He(o,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(i=-1===t?o:arguments[t],Qe(i)){if(c+(a=le(i.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(r=0;r<a;r++,c++)r in i&&Fe(s,c,i[r])}else{if(c>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Fe(s,c++,i)}return s.length=c,s}});var et,tt=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},rt=function(e,t,r){if(tt(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,a){return e.call(t,r,n,a)}}return function(){return e.apply(t,arguments)}},nt=[].push,at=function(e){var t=1==e,r=2==e,n=3==e,a=4==e,i=6==e,o=5==e||i;return function(s,c,u,l){for(var h,_,f=Ce(s),d=p(f),v=rt(c,u,3),m=le(d.length),g=0,y=l||He,w=t?y(s,m):r?y(s,0):void 0;m>g;g++)if((o||g in d)&&(_=v(h=d[g],g,f),e))if(t)w[g]=_;else if(_)switch(e){case 3:return!0;case 5:return h;case 6:return g;case 2:nt.call(w,h)}else if(a)return!1;return i?-1:n||a?a:w}},it={forEach:at(0),map:at(1),filter:at(2),some:at(3),every:at(4),find:at(5),findIndex:at(6)},ot=Object.keys||function(e){return ve(e,me)},st=o?Object.defineProperties:function(e,t){T(e);for(var r,n=ot(t),a=n.length,i=0;a>i;)k.f(e,r=n[i++],t[r]);return e},ct=ie("document","documentElement"),ut=B("IE_PROTO"),lt=function(){},ht=function(e){return"<script>"+e+"<\/script>"},_t=function(){try{et=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;_t=et?function(e){e.write(ht("")),e.close();var t=e.parentWindow.Object;return e=null,t}(et):((t=b("iframe")).style.display="none",ct.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(ht("document.F=Object")),e.close(),e.F);for(var r=me.length;r--;)delete _t.prototype[me[r]];return _t()};Y[ut]=!0;var ft=Object.create||function(e,t){var r;return null!==e?(lt.prototype=T(e),r=new lt,lt.prototype=null,r[ut]=e):r=_t(),void 0===t?r:st(r,t)},pt=Ue("unscopables"),dt=Array.prototype;null==dt[pt]&&k.f(dt,pt,{configurable:!0,value:ft(null)});var vt,mt=Object.defineProperty,gt={},yt=function(e){throw e},wt=function(e,t){if(w(gt,e))return gt[e];t||(t={});var r=[][e],n=!!w(t,"ACCESSORS")&&t.ACCESSORS,a=w(t,0)?t[0]:yt,s=w(t,1)?t[1]:void 0;return gt[e]=!!r&&!i((function(){if(n&&!o)return!0;var e={length:-1};n?mt(e,1,{enumerable:!0,get:yt}):e[1]=1,r.call(e,a,s)}))},Et=it.find,Mt=!0,bt=wt("find");"find"in[]&&Array(1).find((function(){Mt=!1})),Pe({target:"Array",proto:!0,forced:Mt||!bt},{find:function(e){return Et(this,e,arguments.length>1?arguments[1]:void 0)}}),vt="find",dt[pt][vt]=!0;var At=qe("slice"),xt=wt("slice",{ACCESSORS:!0,0:0,1:2}),Rt=Ue("species"),Tt=[].slice,Ot=Math.max;Pe({target:"Array",proto:!0,forced:!At||!xt},{slice:function(e,t){var r,n,a,i=v(this),o=le(i.length),s=fe(e,o),c=fe(void 0===t?o:t,o);if(Se(i)&&("function"!=typeof(r=i.constructor)||r!==Array&&!Se(r.prototype)?m(r)&&null===(r=r[Rt])&&(r=void 0):r=void 0,r===Array||void 0===r))return Tt.call(i,s,c);for(n=new(void 0===r?Array:r)(Ot(c-s,0)),a=0;s<c;s++,a++)s in i&&Fe(n,a,i[s]);return n.length=a,n}});var kt=[].slice,Lt={},Pt=function(e,t,r){if(!(t in Lt)){for(var n=[],a=0;a<t;a++)n[a]="a["+a+"]";Lt[t]=Function("C,a","return new C("+n.join(",")+")")}return Lt[t](e,r)};Pe({target:"Function",proto:!0},{bind:Function.bind||function(e){var t=tt(this),r=kt.call(arguments,1),n=function(){var a=r.concat(kt.call(arguments));return this instanceof n?Pt(t,a.length,a):t.apply(e,a)};return m(t.prototype)&&(n.prototype=t.prototype),n}}),Pe({target:"Math",stat:!0},{sign:Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}});var St="".repeat||function(e){var t=String(d(this)),r="",n=ce(e);if(n<0||n==1/0)throw RangeError("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r},Ct=1..toFixed,Ft=Math.floor,Nt=function(e,t,r){return 0===t?r:t%2==1?Nt(e,t-1,r*e):Nt(e*e,t/2,r)};Pe({target:"Number",proto:!0,forced:Ct&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!i((function(){Ct.call({})}))},{toFixed:function(e){var t,r,n,a,i=function(e){if("number"!=typeof e&&"Number"!=_(e))throw TypeError("Incorrect invocation");return+e}(this),o=ce(e),s=[0,0,0,0,0,0],c="",u="0",l=function(e,t){for(var r=-1,n=t;++r<6;)n+=e*s[r],s[r]=n%1e7,n=Ft(n/1e7)},h=function(e){for(var t=6,r=0;--t>=0;)r+=s[t],s[t]=Ft(r/e),r=r%e*1e7},f=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==s[e]){var r=String(s[e]);t=""===t?r:t+St.call("0",7-r.length)+r}return t};if(o<0||o>20)throw RangeError("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return String(i);if(i<0&&(c="-",i=-i),i>1e-21)if(r=(t=function(e){for(var t=0,r=e;r>=4096;)t+=12,r/=4096;for(;r>=2;)t+=1,r/=2;return t}(i*Nt(2,69,1))-69)<0?i*Nt(2,-t,1):i/Nt(2,t,1),r*=4503599627370496,(t=52-t)>0){for(l(0,r),n=o;n>=7;)l(1e7,0),n-=7;for(l(Nt(10,n,1),0),n=t-1;n>=23;)h(1<<23),n-=23;h(1<<n),l(1,1),h(2),u=f()}else l(0,r),l(1<<-t,0),u=f()+St.call("0",o);return u=o>0?c+((a=u.length)<=o?"0."+St.call("0",o-a)+u:u.slice(0,a-o)+"."+u.slice(a-o)):c+u}});var It={};It[Ue("toStringTag")]="z";var jt="[object z]"===String(It),Gt=Ue("toStringTag"),Vt="Arguments"==_(function(){return arguments}()),Ut=jt?_:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Gt))?r:Vt?_(t):"Object"==(n=_(t))&&"function"==typeof t.callee?"Arguments":n},Dt=jt?{}.toString:function(){return"[object "+Ut(this)+"]"};jt||re(Object.prototype,"toString",Dt,{unsafe:!0});var Ht="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",Kt="["+Ht+"]",zt=RegExp("^"+Kt+Kt+"*"),Bt=RegExp(Kt+Kt+"*$"),Yt=function(e){return function(t){var r=String(d(t));return 1&e&&(r=r.replace(zt,"")),2&e&&(r=r.replace(Bt,"")),r}},$t={start:Yt(1),end:Yt(2),trim:Yt(3)}.trim,Wt=a.parseFloat,qt=1/Wt(Ht+"-0")!=-1/0?function(e){var t=$t(String(e)),r=Wt(t);return 0===r&&"-"==t.charAt(0)?-0:r}:Wt;Pe({global:!0,forced:parseFloat!=qt},{parseFloat:qt});var Xt=a.Promise,Zt=k.f,Jt=Ue("toStringTag"),Qt=Ue("species"),er={},tr=Ue("iterator"),rr=Array.prototype,nr=Ue("iterator"),ar=function(e,t,r,n){try{return n?t(T(r)[0],r[1]):t(r)}catch(t){var a=e.return;throw void 0!==a&&T(a.call(e)),t}},ir=r((function(e){var t=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,r,n,a,i){var o,s,c,u,l,h,_,f,p=rt(r,n,a?2:1);if(i)o=e;else{if("function"!=typeof(s=function(e){if(null!=e)return e[nr]||e["@@iterator"]||er[Ut(e)]}(e)))throw TypeError("Target is not iterable");if(void 0!==(f=s)&&(er.Array===f||rr[tr]===f)){for(c=0,u=le(e.length);u>c;c++)if((l=a?p(T(_=e[c])[0],_[1]):p(e[c]))&&l instanceof t)return l;return new t(!1)}o=s.call(e)}for(h=o.next;!(_=h.call(o)).done;)if("object"==typeof(l=ar(o,p,_.value,a))&&l&&l instanceof t)return l;return new t(!1)}).stop=function(e){return new t(!0,e)}})),or=Ue("iterator"),sr=!1;try{var cr=0,ur={next:function(){return{done:!!cr++}},return:function(){sr=!0}};ur[or]=function(){return this},Array.from(ur,(function(){throw 2}))}catch(e){}var lr,hr,_r,fr=Ue("species"),pr=function(e,t){var r,n=T(e).constructor;return void 0===n||null==(r=T(n)[fr])?t:tt(r)},dr=/(iphone|ipod|ipad).*applewebkit/i.test(Ke),vr=a.location,mr=a.setImmediate,gr=a.clearImmediate,yr=a.process,wr=a.MessageChannel,Er=a.Dispatch,Mr=0,br={},Ar=function(e){if(br.hasOwnProperty(e)){var t=br[e];delete br[e],t()}},xr=function(e){return function(){Ar(e)}},Rr=function(e){Ar(e.data)},Tr=function(e){a.postMessage(e+"",vr.protocol+"//"+vr.host)};mr&&gr||(mr=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return br[++Mr]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},lr(Mr),Mr},gr=function(e){delete br[e]},"process"==_(yr)?lr=function(e){yr.nextTick(xr(e))}:Er&&Er.now?lr=function(e){Er.now(xr(e))}:wr&&!dr?(_r=(hr=new wr).port2,hr.port1.onmessage=Rr,lr=rt(_r.postMessage,_r,1)):!a.addEventListener||"function"!=typeof postMessage||a.importScripts||i(Tr)?lr="onreadystatechange"in b("script")?function(e){ct.appendChild(b("script")).onreadystatechange=function(){ct.removeChild(this),Ar(e)}}:function(e){setTimeout(xr(e),0)}:(lr=Tr,a.addEventListener("message",Rr,!1)));var Or,kr,Lr,Pr,Sr,Cr,Fr,Nr,Ir={set:mr,clear:gr},jr=R.f,Gr=Ir.set,Vr=a.MutationObserver||a.WebKitMutationObserver,Ur=a.process,Dr=a.Promise,Hr="process"==_(Ur),Kr=jr(a,"queueMicrotask"),zr=Kr&&Kr.value;zr||(Or=function(){var e,t;for(Hr&&(e=Ur.domain)&&e.exit();kr;){t=kr.fn,kr=kr.next;try{t()}catch(e){throw kr?Pr():Lr=void 0,e}}Lr=void 0,e&&e.enter()},Hr?Pr=function(){Ur.nextTick(Or)}:Vr&&!dr?(Sr=!0,Cr=document.createTextNode(""),new Vr(Or).observe(Cr,{characterData:!0}),Pr=function(){Cr.data=Sr=!Sr}):Dr&&Dr.resolve?(Fr=Dr.resolve(void 0),Nr=Fr.then,Pr=function(){Nr.call(Fr,Or)}):Pr=function(){Gr.call(a,Or)});var Br,Yr,$r,Wr,qr,Xr,Zr,Jr=zr||function(e){var t={fn:e,next:void 0};Lr&&(Lr.next=t),kr||(kr=t,Pr()),Lr=t},Qr=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=tt(t),this.reject=tt(r)},en={f:function(e){return new Qr(e)}},tn=function(e,t){if(T(e),m(t)&&t.constructor===e)return t;var r=en.f(e);return(0,r.resolve)(t),r.promise},rn=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},nn=Ir.set,an=Ue("species"),on="Promise",sn=te.get,cn=te.set,un=te.getterFor(on),ln=Xt,hn=a.TypeError,_n=a.document,fn=a.process,pn=ie("fetch"),dn=en.f,vn=dn,mn="process"==_(fn),gn=!!(_n&&_n.createEvent&&a.dispatchEvent),yn=ke(on,(function(){if(!(j(ln)!==String(ln))){if(66===$e)return!0;if(!mn&&"function"!=typeof PromiseRejectionEvent)return!0}if($e>=51&&/native code/.test(ln))return!1;var e=ln.resolve(1),t=function(e){e((function(){}),(function(){}))};return(e.constructor={})[an]=t,!(e.then((function(){}))instanceof t)})),wn=yn||!function(e,t){if(!t&&!sr)return!1;var r=!1;try{var n={};n[or]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r}((function(e){ln.all(e).catch((function(){}))})),En=function(e){var t;return!(!m(e)||"function"!=typeof(t=e.then))&&t},Mn=function(e,t,r){if(!t.notified){t.notified=!0;var n=t.reactions;Jr((function(){for(var a=t.value,i=1==t.state,o=0;n.length>o;){var s,c,u,l=n[o++],h=i?l.ok:l.fail,_=l.resolve,f=l.reject,p=l.domain;try{h?(i||(2===t.rejection&&Rn(e,t),t.rejection=1),!0===h?s=a:(p&&p.enter(),s=h(a),p&&(p.exit(),u=!0)),s===l.promise?f(hn("Promise-chain cycle")):(c=En(s))?c.call(s,_,f):_(s)):f(a)}catch(e){p&&!u&&p.exit(),f(e)}}t.reactions=[],t.notified=!1,r&&!t.rejection&&An(e,t)}))}},bn=function(e,t,r){var n,i;gn?((n=_n.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),a.dispatchEvent(n)):n={promise:t,reason:r},(i=a["on"+e])?i(n):"unhandledrejection"===e&&function(e,t){var r=a.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))}("Unhandled promise rejection",r)},An=function(e,t){nn.call(a,(function(){var r,n=t.value;if(xn(t)&&(r=rn((function(){mn?fn.emit("unhandledRejection",n,e):bn("unhandledrejection",e,n)})),t.rejection=mn||xn(t)?2:1,r.error))throw r.value}))},xn=function(e){return 1!==e.rejection&&!e.parent},Rn=function(e,t){nn.call(a,(function(){mn?fn.emit("rejectionHandled",e):bn("rejectionhandled",e,t.value)}))},Tn=function(e,t,r,n){return function(a){e(t,r,a,n)}},On=function(e,t,r,n){t.done||(t.done=!0,n&&(t=n),t.value=r,t.state=2,Mn(e,t,!0))},kn=function(e,t,r,n){if(!t.done){t.done=!0,n&&(t=n);try{if(e===r)throw hn("Promise can't be resolved itself");var a=En(r);a?Jr((function(){var n={done:!1};try{a.call(r,Tn(kn,e,n,t),Tn(On,e,n,t))}catch(r){On(e,n,r,t)}})):(t.value=r,t.state=1,Mn(e,t,!1))}catch(r){On(e,{done:!1},r,t)}}};yn&&(ln=function(e){!function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation")}(this,ln,on),tt(e),Br.call(this);var t=sn(this);try{e(Tn(kn,this,t),Tn(On,this,t))}catch(e){On(this,t,e)}},(Br=function(e){cn(this,{type:on,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=function(e,t,r){for(var n in t)re(e,n,t[n],r);return e}(ln.prototype,{then:function(e,t){var r=un(this),n=dn(pr(this,ln));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=mn?fn.domain:void 0,r.parent=!0,r.reactions.push(n),0!=r.state&&Mn(this,r,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),Yr=function(){var e=new Br,t=sn(e);this.promise=e,this.resolve=Tn(kn,e,t),this.reject=Tn(On,e,t)},en.f=dn=function(e){return e===ln||e===$r?new Yr(e):vn(e)},"function"==typeof Xt&&(Wr=Xt.prototype.then,re(Xt.prototype,"then",(function(e,t){var r=this;return new ln((function(e,t){Wr.call(r,e,t)})).then(e,t)}),{unsafe:!0}),"function"==typeof pn&&Pe({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return tn(ln,pn.apply(a,arguments))}}))),Pe({global:!0,wrap:!0,forced:yn},{Promise:ln}),Xr=on,Zr=!1,(qr=ln)&&!w(qr=Zr?qr:qr.prototype,Jt)&&Zt(qr,Jt,{configurable:!0,value:Xr}),function(e){var t=ie(e),r=k.f;o&&t&&!t[Qt]&&r(t,Qt,{configurable:!0,get:function(){return this}})}(on),$r=ie(on),Pe({target:on,stat:!0,forced:yn},{reject:function(e){var t=dn(this);return t.reject.call(void 0,e),t.promise}}),Pe({target:on,stat:!0,forced:yn},{resolve:function(e){return tn(this,e)}}),Pe({target:on,stat:!0,forced:wn},{all:function(e){var t=this,r=dn(t),n=r.resolve,a=r.reject,i=rn((function(){var r=tt(t.resolve),i=[],o=0,s=1;ir(e,(function(e){var c=o++,u=!1;i.push(void 0),s++,r.call(t,e).then((function(e){u||(u=!0,i[c]=e,--s||n(i))}),a)})),--s||n(i)}));return i.error&&a(i.value),r.promise},race:function(e){var t=this,r=dn(t),n=r.reject,a=rn((function(){var a=tt(t.resolve);ir(e,(function(e){a.call(t,e).then(r.resolve,n)}))}));return a.error&&n(a.value),r.promise}});var Ln=function(){var e=T(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t};function Pn(e,t){return RegExp(e,t)}var Sn,Cn,Fn={UNSUPPORTED_Y:i((function(){var e=Pn("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),BROKEN_CARET:i((function(){var e=Pn("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},Nn=RegExp.prototype.exec,In=String.prototype.replace,jn=Nn,Gn=(Sn=/a/,Cn=/b*/g,Nn.call(Sn,"a"),Nn.call(Cn,"a"),0!==Sn.lastIndex||0!==Cn.lastIndex),Vn=Fn.UNSUPPORTED_Y||Fn.BROKEN_CARET,Un=void 0!==/()??/.exec("")[1];(Gn||Un||Vn)&&(jn=function(e){var t,r,n,a,i=this,o=Vn&&i.sticky,s=Ln.call(i),c=i.source,u=0,l=e;return o&&(-1===(s=s.replace("y","")).indexOf("g")&&(s+="g"),l=String(e).slice(i.lastIndex),i.lastIndex>0&&(!i.multiline||i.multiline&&"\n"!==e[i.lastIndex-1])&&(c="(?: "+c+")",l=" "+l,u++),r=new RegExp("^(?:"+c+")",s)),Un&&(r=new RegExp("^"+c+"$(?!\\s)",s)),Gn&&(t=i.lastIndex),n=Nn.call(o?r:i,l),o?n?(n.input=n.input.slice(u),n[0]=n[0].slice(u),n.index=i.lastIndex,i.lastIndex+=n[0].length):i.lastIndex=0:Gn&&n&&(i.lastIndex=i.global?n.index+n[0].length:t),Un&&n&&n.length>1&&In.call(n[0],r,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(n[a]=void 0)})),n});var Dn=jn;Pe({target:"RegExp",proto:!0,forced:/./.exec!==Dn},{exec:Dn});var Hn=Ue("species"),Kn=!i((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),zn="$0"==="a".replace(/./,"$0"),Bn=Ue("replace"),Yn=!!/./[Bn]&&""===/./[Bn]("a","$0"),$n=!i((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]})),Wn=function(e,t,r,n){var a=Ue(e),o=!i((function(){var t={};return t[a]=function(){return 7},7!=""[e](t)})),s=o&&!i((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[Hn]=function(){return r},r.flags="",r[a]=/./[a]),r.exec=function(){return t=!0,null},r[a](""),!t}));if(!o||!s||"replace"===e&&(!Kn||!zn||Yn)||"split"===e&&!$n){var c=/./[a],u=r(a,""[e],(function(e,t,r,n,a){return t.exec===Dn?o&&!a?{done:!0,value:c.call(t,r,n)}:{done:!0,value:e.call(r,t,n)}:{done:!1}}),{REPLACE_KEEPS_$0:zn,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:Yn}),l=u[0],h=u[1];re(String.prototype,e,l),re(RegExp.prototype,a,2==t?function(e,t){return h.call(e,this,t)}:function(e){return h.call(e,this)})}n&&L(RegExp.prototype[a],"sham",!0)},qn=function(e){return function(t,r){var n,a,i=String(d(t)),o=ce(r),s=i.length;return o<0||o>=s?e?"":void 0:(n=i.charCodeAt(o))<55296||n>56319||o+1===s||(a=i.charCodeAt(o+1))<56320||a>57343?e?i.charAt(o):n:e?i.slice(o,o+2):a-56320+(n-55296<<10)+65536}},Xn={codeAt:qn(!1),charAt:qn(!0)}.charAt,Zn=function(e,t,r){return t+(r?Xn(e,t).length:1)},Jn=function(e,t){var r=e.exec;if("function"==typeof r){var n=r.call(e,t);if("object"!=typeof n)throw TypeError("RegExp exec method returned something other than an Object or null");return n}if("RegExp"!==_(e))throw TypeError("RegExp#exec called on incompatible receiver");return Dn.call(e,t)},Qn=Math.max,ea=Math.min,ta=Math.floor,ra=/\$([$&'`]|\d\d?|<[^>]*>)/g,na=/\$([$&'`]|\d\d?)/g,aa=function(e){return void 0===e?e:String(e)};Wn("replace",2,(function(e,t,r,n){var a=n.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,i=n.REPLACE_KEEPS_$0,o=a?"$":"$0";return[function(r,n){var a=d(this),i=null==r?void 0:r[e];return void 0!==i?i.call(r,a,n):t.call(String(a),r,n)},function(e,n){if(!a&&i||"string"==typeof n&&-1===n.indexOf(o)){var c=r(t,e,this,n);if(c.done)return c.value}var u=T(e),l=String(this),h="function"==typeof n;h||(n=String(n));var _=u.global;if(_){var f=u.unicode;u.lastIndex=0}for(var p=[];;){var d=Jn(u,l);if(null===d)break;if(p.push(d),!_)break;""===String(d[0])&&(u.lastIndex=Zn(l,le(u.lastIndex),f))}for(var v="",m=0,g=0;g<p.length;g++){d=p[g];for(var y=String(d[0]),w=Qn(ea(ce(d.index),l.length),0),E=[],M=1;M<d.length;M++)E.push(aa(d[M]));var b=d.groups;if(h){var A=[y].concat(E,w,l);void 0!==b&&A.push(b);var x=String(n.apply(void 0,A))}else x=s(y,l,w,E,b,n);w>=m&&(v+=l.slice(m,w)+x,m=w+y.length)}return v+l.slice(m)}];function s(e,r,n,a,i,o){var s=n+e.length,c=a.length,u=na;return void 0!==i&&(i=Ce(i),u=ra),t.call(o,u,(function(t,o){var u;switch(o.charAt(0)){case"$":return"$";case"&":return e;case"`":return r.slice(0,n);case"'":return r.slice(s);case"<":u=i[o.slice(1,-1)];break;default:var l=+o;if(0===l)return t;if(l>c){var h=ta(l/10);return 0===h?t:h<=c?void 0===a[h-1]?o.charAt(1):a[h-1]+o.charAt(1):t}u=a[l-1]}return void 0===u?"":u}))}}));var ia=Ue("match"),oa=[].push,sa=Math.min,ca=!i((function(){return!RegExp(4294967295,"y")}));Wn("split",2,(function(e,t,r){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var n=String(d(this)),a=void 0===r?4294967295:r>>>0;if(0===a)return[];if(void 0===e)return[n];if(!function(e){var t;return m(e)&&(void 0!==(t=e[ia])?!!t:"RegExp"==_(e))}(e))return t.call(n,e,a);for(var i,o,s,c=[],u=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,h=new RegExp(e.source,u+"g");(i=Dn.call(h,n))&&!((o=h.lastIndex)>l&&(c.push(n.slice(l,i.index)),i.length>1&&i.index<n.length&&oa.apply(c,i.slice(1)),s=i[0].length,l=o,c.length>=a));)h.lastIndex===i.index&&h.lastIndex++;return l===n.length?!s&&h.test("")||c.push(""):c.push(n.slice(l)),c.length>a?c.slice(0,a):c}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:t.call(this,e,r)}:t,[function(t,r){var a=d(this),i=null==t?void 0:t[e];return void 0!==i?i.call(t,a,r):n.call(String(a),t,r)},function(e,a){var i=r(n,e,this,a,n!==t);if(i.done)return i.value;var o=T(e),s=String(this),c=pr(o,RegExp),u=o.unicode,l=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(ca?"y":"g"),h=new c(ca?o:"^(?:"+o.source+")",l),_=void 0===a?4294967295:a>>>0;if(0===_)return[];if(0===s.length)return null===Jn(h,s)?[s]:[];for(var f=0,p=0,d=[];p<s.length;){h.lastIndex=ca?p:0;var v,m=Jn(h,ca?s:s.slice(p));if(null===m||(v=sa(le(h.lastIndex+(ca?0:p)),s.length))===f)p=Zn(s,p,u);else{if(d.push(s.slice(f,p)),d.length===_)return d;for(var g=1;g<=m.length-1;g++)if(d.push(m[g]),d.length===_)return d;p=f=v}}return d.push(s.slice(f)),d}]}),!ca);r((function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var a=t&&t.prototype instanceof h?t:h,i=Object.create(a.prototype),o=new b(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(a,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw i;return x()}for(r.method=a,r.arg=i;;){var o=r.delegate;if(o){var s=w(o,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,o),i}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function h(){}function _(){}function f(){}var p={};p[a]=function(){return this};var d=Object.getPrototypeOf,v=d&&d(d(A([])));v&&v!==t&&r.call(v,a)&&(p=v);var m=f.prototype=h.prototype=Object.create(p);function g(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){var n;this._invoke=function(a,i){function o(){return new t((function(n,o){!function n(a,i,o,s){var c=u(e[a],e,i);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(h).then((function(e){l.value=e,o(l)}),(function(e){return n("throw",e,o,s)}))}s(c.arg)}(a,i,n,o)}))}return n=n?n.then(o,o):o()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var a=n.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function A(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return _.prototype=m.constructor=f,f.constructor=_,_.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},g(y.prototype),y.prototype[i]=function(){return this},e.AsyncIterator=y,e.async=function(t,r,n,a,i){void 0===i&&(i=Promise);var o=new y(c(t,r,n,a),i);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},g(m),s(m,o,"Generator"),m[a]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=A,b.prototype={constructor:b,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;M(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function ua(e,t,r,n,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,a)}function la(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ha(e){return(ha=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _a(e,t){return(_a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fa(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}var pa=e.GeoMath,da=e.GeoPoint,va=function(t){function r(t,n,a){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(i=fa(this,ha(r).call(this))).createViewer(t,n,a),i._camera_parameter={latitude:0,longitude:0,height:0,pitch:0,yaw:0,fov:0,near:0,far:0},i._operation_mode=r.OperationMode.NONE,i._mouse_down_position=pa.createVector2f(),i._pre_mouse_position=pa.createVector2f(),i._rotate_center=pa.createVector3(),i._translate_drag=pa.createVector2f(),i._translate_eye_drag=pa.createVector2f(),i._rotate_drag=pa.createVector2f(),i._free_rotate_drag=pa.createVector2f(),i._height_drag=pa.createVector2f(),i._zoom_wheel=0,i._fovy_key=0,i._default_fov=r.DEFAULT_CAMERA_PARAMETER.fov,i._key_mode=!1,i._update_url_hash=!1,i._update_url_hash_full_digits=!1,i._last_camera_parameter={latitude:-1,longitude:-1,height:0,pitch:0,yaw:0,fov:0,near:0,far:0},i._viewerCameraMode=r.CameraMode.CAMERA_FREE,i._animation=new e.animation.EasyBindingBlock,i._updater=new e.animation.Updater,i._curve_move=null,i._curve_rotation=null,i._flycamera_total_time=0,i._flycamera_target_time=0,i._flyPosition=new e.GeoPoint(0,0,0),i._flyRotation=pa.setIdentity(pa.createMatrix()),i._initCameraParameter(a),i}var n,a,i,o,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_a(e,t)}(r,t),n=r,(a=[{key:"createViewer",value:function(t,r,n){this._viewer&&this.destroy(),this._viewer=new e.Viewer(t,{dem_provider:this._createDemProvider(r,n),image_provider:this._createImageProvider(n),layers:n&&n.layers||null,render_callback:this,render_mode:n&&n.render_mode||e.Viewer.RenderMode.SURFACE,debug_stats:n&&n.debug_stats||null,attribution_controller:n&&n.attribution_controller||null});var a=this._viewer._canvas_element;return a.setAttribute("oncontextmenu","return false;"),a.setAttribute("tabindex","0"),this._addEventListener(),this._viewer}},{key:"destroy",value:function(){this._viewer&&(this._removeEventListener(),this._viewer.destroy(),this._viewer=null)}},{key:"_createDemProvider",value:function(t,r){return r&&r.dem_provider||new e.CloudDemProvider(t)}},{key:"_createImageProvider",value:function(t){return t&&t.image_provider||new e.StandardImageProvider("https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/",".jpg",256,2,18)}},{key:"_initCameraParameter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.camera_position||r.DEFAULT_CAMERA_POSITION,n=e.lookat_position||r.DEFAULT_LOOKAT_POSITION,a=e.camera_parameter||r.DEFAULT_CAMERA_PARAMETER;this.setCameraPosition(t),this.setLookAtPosition(n),this.setCameraParameter(a),this._updateViewerCamera()}},{key:"initCameraParameterFromURL",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.camera_position||r.DEFAULT_CAMERA_POSITION,n=e.lookat_position||r.DEFAULT_LOOKAT_POSITION,a=e.camera_parameter||r.DEFAULT_CAMERA_PARAMETER,i=0;e.url_update&&this.setURLUpdate(e.url_update);var o=this._extractURLParameter();o&&(t=o.camera_position,n=o.lookat_position,i=o.yaw),this.setCameraPosition(t),this.setLookAtPosition(n,i),this.setCameraParameter(a),this._updateViewerCamera()}},{key:"_extractURLParameter",value:function(){var e=window.location.hash;if(0!==e.length){var t=(e=e.slice(1)).split("/");if(!(t.length<2)){var r=parseFloat(t[0]);if("number"==typeof r&&isFinite(r)){var n=r;if("number"==typeof(r=parseFloat(t[1]))&&isFinite(r)){for(var a=r,i=8e3,o=1e3,s=0,c=0,u=2;t.length>u;u++){var l=t[u],h=this._getURLParameterValue(l);if(!isNaN(h))switch(l.slice(-1)){case"a":i=h;break;case"t":s=h;break;case"r":o=h;break;case"h":c=h}}var _=s*pa.DEGREE,f=o*Math.cos(_),p=o*Math.sin(_),d=this._destination(a,n,p,c);return{camera_position:{height:i+f,longitude:d.longitude,latitude:d.latitude},lookat_position:{height:i,longitude:a,latitude:n},yaw:c}}}}}}},{key:"_getURLParameterValue",value:function(e){var t=parseFloat(e);return"number"==typeof t&&isFinite(t)?t:NaN}},{key:"_addEventListener",value:function(){var e=this._viewer._canvas_element;this._onBlur=this._onBlur.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),window.addEventListener("blur",this._onBlur,{passive:!1}),e.addEventListener("mousedown",this._onMouseDown,{passive:!0}),e.addEventListener("mousemove",this._onMouseMove,{passive:!0}),document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),e.addEventListener("mouseup",this._onMouseUp,{passive:!0}),document.addEventListener("mouseup",this._onMouseUp,{capture:!1}),e.addEventListener("wheel",this._onMouseWheel,{passive:!1}),e.addEventListener("keydown",this._onKeyDown,{capture:!1,passive:!1}),e.addEventListener("keyup",this._onKeyUp,{passive:!0})}},{key:"_removeEventListener",value:function(){var e=this._viewer._canvas_element;window.removeEventListener("blur",this._onBlur,{passive:!1}),e.removeEventListener("mousedown",this._onMouseDown,{passive:!0}),e.removeEventListener("mousemove",this._onMouseMove,{passive:!0}),document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),e.removeEventListener("mouseup",this._onMouseUp,{passive:!0}),document.removeEventListener("mouseup",this._onMouseUp,{capture:!1}),e.removeEventListener("wheel",this._onMouseWheel,{passive:!1}),e.removeEventListener("keydown",this._onKeyDown,{capture:!1,passive:!1}),e.removeEventListener("keyup",this._onKeyUp,{passive:!0})}},{key:"onStart",value:function(){}},{key:"onStop",value:function(){}},{key:"onUpdateFrame",value:function(e){this._viewerCameraMode===r.CameraMode.CAMERA_FLY?this.updateFlyCamera(e):(this._translation(e),this._rotation(),this._freeRotation(e),this._translationOfHeight(),this._translationOfEyeDirection(),this._changeFovy(),this._correctAltitude(),this._updateClipPlane(),this._updateViewerCamera())}},{key:"_updateViewerCamera",value:function(){var e=this._viewer.camera,t=new da(this._camera_parameter.longitude,this._camera_parameter.latitude,this._camera_parameter.height).getMlocsToGocsMatrix(pa.createMatrix()),r=pa.rotation_matrix([1,0,0],this._camera_parameter.pitch,pa.createMatrix()),n=pa.rotation_matrix([0,0,1],this._camera_parameter.yaw,pa.createMatrix()),a=pa.mul_AA(n,r,pa.createMatrix());e.view_to_gocs=pa.mul_AA(t,a,pa.createMatrix()),e.fov=this._camera_parameter.fov,e.near=this._camera_parameter.near,e.far=this._camera_parameter.far,this._updateURLHash()}},{key:"setURLUpdate",value:function(e){this._update_url_hash=e}},{key:"_updateURLHash",value:function(){if(this._update_url_hash&&this._operation_mode===r.OperationMode.NONE&&(this._last_camera_parameter.latitude!==this._camera_parameter.latitude||this._last_camera_parameter.longitude!==this._camera_parameter.longitude||this._last_camera_parameter.height!==this._camera_parameter.height||this._last_camera_parameter.pitch!==this._camera_parameter.pitch||this._last_camera_parameter.yaw!==this._camera_parameter.yaw)){var t=this._viewer.canvas_element,n=[t.width/2,t.height/2],a=this.viewer.camera.getCanvasRay(n,new e.Ray),i=this.viewer.getRayIntersection(a);if(null!=i){var o=new e.GeoPoint;o.setFromGocs(i);var s,c,u,l,h,_,f,p=this._viewer.getElevation(o.latitude,o.longitude),d=new e.GeoPoint(o.longitude,o.latitude,p).getAsGocs(pa.createVector3()),v=this._viewer.camera,m=v.view_to_gocs[12]-d[0],g=v.view_to_gocs[13]-d[1],y=v.view_to_gocs[14]-d[2],w=Math.sqrt(m*m+g*g+y*y);this._update_url_hash_full_digits?(c=o.latitude,u=o.longitude,l=p,h=this._camera_parameter.pitch,_=w,f=this._camera_parameter.yaw):(c=o.latitude.toFixed(10),u=o.longitude.toFixed(10),l=p.toFixed(5),h=this._camera_parameter.pitch.toFixed(5),_=w.toFixed(5),f=this._camera_parameter.yaw.toFixed(5)),s="#".concat(c,"/").concat(u,"/").concat(l,"a/").concat(h,"t/").concat(_,"r/").concat(f,"h"),this._last_camera_parameter.latitude=this._camera_parameter.latitude,this._last_camera_parameter.longitude=this._camera_parameter.longitude,this._last_camera_parameter.height=this._camera_parameter.height,this._last_camera_parameter.pitch=this._camera_parameter.pitch,this._last_camera_parameter.yaw=this._camera_parameter.yaw;var E=window.location.href.replace(window.location.hash,s);window.location.replace(E)}}}},{key:"_updateClipPlane",value:function(){var e=this._viewer.getElevation(this._camera_parameter.latitude,this._camera_parameter.longitude),t=Math.max(this._camera_parameter.height-e,r.MINIMUM_HEIGHT);this._camera_parameter.near=Math.max(t*r.NEAR_FACTOR,r.MINIMUM_NEAR),this._camera_parameter.far=Math.max(this._camera_parameter.near*r.FAR_FACTOR,r.MINIMUM_FAR)}},{key:"_correctAltitude",value:function(){var e=this._viewer.getElevation(this._camera_parameter.latitude,this._camera_parameter.longitude);this._camera_parameter.height=Math.max(this._camera_parameter.height,e+r.MINIMUM_HEIGHT)}},{key:"resetOpEvent",value:function(){this._resetEventParameter()}},{key:"onBlur",value:function(e){this._resetEventParameter()}},{key:"_onBlur",value:function(e){this.onBlur(e)}},{key:"onMouseDown",value:function(e,t){if(this._mouse_down_position=e,this._pre_mouse_position=e,0===t.button)if(t.shiftKey){this._operation_mode=r.OperationMode.ROTATE;var n=this._viewer.camera.getCanvasRay(this._mouse_down_position);this._rotate_center=this._viewer.getRayIntersection(n)}else t.ctrlKey?this._operation_mode=r.OperationMode.FREE_ROTATE:this._operation_mode=r.OperationMode.TRANSLATE;else 1===t.button?(this._operation_mode=r.OperationMode.ROTATE,n=this._viewer.camera.getCanvasRay(this._mouse_down_position),this._rotate_center=this._viewer.getRayIntersection(n)):2===t.button&&(this._operation_mode=t.shiftKey?r.OperationMode.HEIGHT_TRANSLATE:r.OperationMode.EYE_TRANSLATE)}},{key:"_onMouseDown",value:function(e){var t=this._mousePos(this._viewer._canvas_element,e);this.onMouseDown(t,e)}},{key:"onMouseMove",value:function(e,t){var n=e;this._operation_mode===r.OperationMode.TRANSLATE?(this._translate_drag[0]+=n[0]-this._pre_mouse_position[0],this._translate_drag[1]+=n[1]-this._pre_mouse_position[1]):this._operation_mode===r.OperationMode.ROTATE?(this._rotate_drag[0]+=n[0]-this._pre_mouse_position[0],this._rotate_drag[1]+=n[1]-this._pre_mouse_position[1]):this._operation_mode===r.OperationMode.FREE_ROTATE?(this._free_rotate_drag[0]+=n[0]-this._pre_mouse_position[0],this._free_rotate_drag[1]+=n[1]-this._pre_mouse_position[1]):this._operation_mode===r.OperationMode.HEIGHT_TRANSLATE?(this._translate_drag[0]+=n[0]-this._pre_mouse_position[0],this._height_drag[1]+=n[1]-this._pre_mouse_position[1]):this._operation_mode===r.OperationMode.EYE_TRANSLATE&&(this._translate_eye_drag[1]+=n[1]-this._pre_mouse_position[1]),this._pre_mouse_position=n}},{key:"_onMouseMove",value:function(e){var t=this._mousePos(this._viewer._canvas_element,e);this.onMouseMove(t,e)}},{key:"onMouseUp",value:function(e,t){this._resetEventParameter()}},{key:"_onMouseUp",value:function(e){var t=this._mousePos(this._viewer._canvas_element,e);this.onMouseUp(t,e)}},{key:"onMouseWheel",value:function(e,t){var n;(t.preventDefault(),this._viewerCameraMode==r.CameraMode.CAMERA_FREE)&&(this._mouse_down_position=e,n=-1*Math.sign(t.deltaY)*Math.ceil(Math.abs(t.deltaY)/100),this._zoom_wheel+=n)}},{key:"_onMouseWheel",value:function(e){var t=this._mousePos(this._viewer._canvas_element,e);this.onMouseWheel(t,e)}},{key:"onKeyDown",value:function(e){switch(e.key){case"c":case"C":this._operation_mode=r.OperationMode.CHANGE_FOVY,this._fovy_key=1;break;case"z":case"Z":this._operation_mode=r.OperationMode.CHANGE_FOVY,this._fovy_key=-1;break;case"x":case"X":this._camera_parameter.fov=this._default_fov;break;case"ArrowUp":e.preventDefault();var t=[(n=this._viewer.canvas_element).width/2,n.height/2];this._mouse_down_position=t,this._translate_drag[1]=100,this._key_mode=!0;break;case"ArrowDown":var n;e.preventDefault(),t=[(n=this._viewer.canvas_element).width/2,n.height/2],this._mouse_down_position=t,this._translate_drag[1]=-100,this._key_mode=!0;break;case"ArrowLeft":e.preventDefault(),this._free_rotate_drag[0]=100,this._key_mode=!0;break;case"ArrowRight":e.preventDefault(),this._free_rotate_drag[0]=-100,this._key_mode=!0}}},{key:"_onKeyDown",value:function(e){this.onKeyDown(e)}},{key:"onKeyUp",value:function(e){switch(e.key){case"c":case"C":this._operation_mode=r.OperationMode.NONE,this._fovy_key=0;break;case"z":case"Z":this._operation_mode=r.OperationMode.NONE,this._fovy_key=0;break;case"ArrowUp":case"ArrowDown":this._operation_mode=r.OperationMode.NONE,this._translate_drag[1]=0,this._key_mode=!1;break;case"ArrowLeft":case"ArrowRight":this._operation_mode=r.OperationMode.NONE,this._free_rotate_drag[0]=0,this._key_mode=!1}}},{key:"_onKeyUp",value:function(e){this.onKeyUp(e)}},{key:"_resetEventParameter",value:function(){this._translate_drag[0]=0,this._translate_drag[1]=0,this._rotate_drag[0]=0,this._rotate_drag[1]=0,this._free_rotate_drag[0]=0,this._free_rotate_drag[1]=0,this._height_drag[0]=0,this._height_drag[1]=0,this._operation_mode=r.OperationMode.NONE}},{key:"_translation",value:function(t){if(0!=this._translate_drag[0]||0!=this._translate_drag[1]){this._key_mode&&(this._translate_drag[0]*=t,this._translate_drag[1]*=t);var r=this._viewer.camera,n=r.getCanvasRay(this._mouse_down_position),a=this._viewer.getRayIntersection(n),i=[this._mouse_down_position[0]+this._translate_drag[0],this._mouse_down_position[1]+this._translate_drag[1]];n=r.getCanvasRay(i);var o=this._viewer.getRayIntersection(n);if(null==a||null==o)return;var s=new e.GeoPoint;s.setFromGocs(a);var c=new e.GeoPoint;c.setFromGocs(o);var u=Math.pow(this._getVectorLength(n.direction),2),l=2*pa.dot3(n.position,n.direction),h=l*l-4*u*(Math.pow(this._getVectorLength(n.position),2)-Math.pow(s.altitude+pa.EARTH_RADIUS,2));if(s.altitude<this._camera_parameter.height&&c.altitude<this._camera_parameter.height&&h>0){var _=(-l+Math.sqrt(h))/2*u,f=(-l-Math.sqrt(h))/2*u,p=Math.min(_,f);o[0]=n.position[0]+p*n.direction[0],o[1]=n.position[1]+p*n.direction[1],o[2]=n.position[2]+p*n.direction[2],c.setFromGocs(o)}var d=c.latitude-s.latitude,v=c.longitude-s.longitude;this._camera_parameter.latitude-=d,this._camera_parameter.longitude-=v,this._translate_drag[0]=0,this._translate_drag[1]=0,this._mouse_down_position=this._pre_mouse_position}}},{key:"_rotation",value:function(){if(0!=this._rotate_drag[0]||0!=this._rotate_drag[1]){if(null==this._rotate_center)return this._rotate_drag[0]=0,void(this._rotate_drag[1]=0);var t=this._viewer.camera,r=pa.createVector3();r[0]=t.view_to_gocs[12]-this._rotate_center[0],r[1]=t.view_to_gocs[13]-this._rotate_center[1],r[2]=t.view_to_gocs[14]-this._rotate_center[2];var n=new e.GeoPoint;n.setFromGocs(this._rotate_center);var a=n.getMlocsToGocsMatrix(pa.createMatrix()),i=pa.createVector3();i[0]=a[8],i[1]=a[9],i[2]=a[10],i=pa.normalize3(i,pa.createVector3());var o=-this._rotate_drag[0]/10,s=-this._rotate_drag[1]/10,c=this._rotateVector(r,i,o),u=pa.clamp(this._camera_parameter.pitch+s,0,90);u!=this._camera_parameter.pitch&&(i[0]=t.view_to_gocs[0],i[1]=t.view_to_gocs[1],i[2]=t.view_to_gocs[2],c=this._rotateVector(c,i,s));var l=pa.createVector3();l[0]=this._rotate_center[0]+c[0],l[1]=this._rotate_center[1]+c[1],l[2]=this._rotate_center[2]+c[2];var h=new e.GeoPoint;h.setFromGocs(l),this._camera_parameter.latitude=h.latitude,this._camera_parameter.longitude=h.longitude,this._camera_parameter.height=h.altitude,this._camera_parameter.yaw+=o,this._camera_parameter.pitch=u,this._rotate_drag[0]=0,this._rotate_drag[1]=0}}},{key:"_freeRotation",value:function(e){if(0!=this._free_rotate_drag[0]||0!=this._free_rotate_drag[1]){this._key_mode&&(this._free_rotate_drag[0]*=e,this._free_rotate_drag[1]*=e);var t=this._free_rotate_drag[0]/10,r=this._free_rotate_drag[1]/10,n=pa.clamp(this._camera_parameter.pitch+r,0,90);this._camera_parameter.yaw+=t,this._camera_parameter.pitch=n,this._free_rotate_drag[0]=0,this._free_rotate_drag[1]=0}}},{key:"_translationOfHeight",value:function(){if(0!=this._height_drag[0]||0!=this._height_drag[1]){var e=100*this._height_drag[1]*(pa.gudermannian((this._camera_parameter.height-5e4)/1e4)+Math.PI/2);this._camera_parameter.height+=e,this._height_drag[0]=0,this._height_drag[1]=0}}},{key:"_translationOfEyeDirection",value:function(){var t=0;if(0!=this._zoom_wheel?(t=Math.pow(.9,this._zoom_wheel),this._zoom_wheel=0):0!=this._translate_eye_drag[1]&&(t=Math.pow(.995,this._translate_eye_drag[1]),this._translate_eye_drag[1]=0),0!==t){var n=this._viewer.camera,a=n.getCanvasRay(this._mouse_down_position),i=this._viewer.getRayIntersection(a);if(null==i)return;var o=new e.GeoPoint;o.setFromGocs(i);var s=pa.createVector3();s[0]=(i[0]-n.view_to_gocs[12])*t,s[1]=(i[1]-n.view_to_gocs[13])*t,s[2]=(i[2]-n.view_to_gocs[14])*t;var c=pa.createVector3();c[0]=i[0]-s[0],c[1]=i[1]-s[1],c[2]=i[2]-s[2];var u=new e.GeoPoint;u.setFromGocs(c);var l=this._viewer.getElevation(u.latitude,u.longitude);if(l+r.MINIMUM_HEIGHT>u.altitude){var h=u.altitude-(l+r.MINIMUM_HEIGHT),_=o.getUpwardVector(pa.createVector3()),f=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),p=pa.dot3(s,_)/f;pa.scale3(1-h/p/f,s,s),c[0]=i[0]-s[0],c[1]=i[1]-s[1],c[2]=i[2]-s[2],u.setFromGocs(c)}this._camera_parameter.latitude=u.latitude,this._camera_parameter.longitude=u.longitude,this._camera_parameter.height=u.altitude,this._zoom_wheel=0}}},{key:"_changeFovy",value:function(){var e=Math.tan(.5*this._camera_parameter.fov*pa.DEGREE),t=2*Math.atan(e*Math.pow(r.FOV_FACTOR,-this._fovy_key)),n=r.FOV_RANGE;this._camera_parameter.fov=pa.clamp(t/pa.DEGREE,n.min,n.max),this._fovy_key=0}},{key:"setCameraPosition",value:function(e){this._camera_parameter.latitude=e.latitude,this._camera_parameter.longitude=e.longitude,this._camera_parameter.height=e.height,this._camera_parameter.height<r.MINIMUM_HEIGHT&&(this._camera_parameter.height=r.MINIMUM_HEIGHT)}},{key:"_isSame",value:function(e,t,r){var n=r||1e-6;return Math.abs(e-t)<n}},{key:"setLookAtPosition",value:function(e,t){if(this._isSame(this._camera_parameter.longitude,e.longitude)&&this._isSame(this._camera_parameter.latitude,e.latitude))return this._camera_parameter.yaw=t||0,void(this._camera_parameter.pitch=0);var r=new da(this._camera_parameter.longitude,this._camera_parameter.latitude,this._camera_parameter.height).getMlocsToGocsMatrix(pa.createMatrix()),n=pa.createVector3();n[0]=r[4],n[1]=r[5],n[2]=r[6];var a=new da(e.longitude,e.latitude,e.height).getMlocsToGocsMatrix(pa.createMatrix()),i=pa.createVector3();i[0]=a[12]-r[12],i[1]=a[13]-r[13],i[2]=a[14]-r[14],n=pa.normalize3(n,pa.createVector3()),i=pa.normalize3(i,pa.createVector3());var o=pa.createVector3();o[0]=r[8],o[1]=r[9],o[2]=r[10];var s=this._calculateAngle(o,n,i);this._camera_parameter.yaw=s;var c=pa.createVector3();c[0]=r[8],c[1]=r[9],c[2]=r[10];var u=pa.createVector3();u[0]=r[0],u[1]=r[1],u[2]=r[2],o=this._rotateVector(u,o,s),i[0]=-1*i[0],i[1]=-1*i[1],i[2]=-1*i[2],this._camera_parameter.pitch=pa.clamp(Math.abs(this._calculateAngle(o,c,i)),0,90)}},{key:"setCameraParameter",value:function(e){e.fov&&(this._camera_parameter.fov=e.fov,this._default_fov=e.fov),e.near&&(this._camera_parameter.near=e.near),e.far&&(this._camera_parameter.far=e.far),e.speed_factor&&(this._camera_parameter.speed_factor=e.speed_factor)}},{key:"getLayer",value:function(e){return this._viewer.layers.getLayer(e)}},{key:"getLayerNum",value:function(){return this._viewer.layers.num_layers()}},{key:"addLayer",value:function(e){this._viewer.layers.add(e)}},{key:"insertLayer",value:function(e,t){this._viewer.layers.insert(e,t)}},{key:"removeLayer",value:function(e){this._viewer.layers.remove(e)}},{key:"clearLayer",value:function(){this._viewer.layers.clear()}},{key:"getEntity",value:function(e){return this._viewer.scene.getEntity(e)}},{key:"getEntityNum",value:function(){return this._viewer.scene.num_entities()}},{key:"addEntity",value:function(e){this._viewer.scene.addEntity(e)}},{key:"removeEntity",value:function(e){this._viewer.scene.removeEntity(e)}},{key:"clearEntity",value:function(){this._viewer.scene.clearEntity()}},{key:"_getVectorLength",value:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2))}},{key:"_rotateVector",value:function(e,t,r){var n=pa.rotation_matrix(t,r,pa.createMatrix()),a=pa.createVector3();return a[0]=e[0]*n[0]+e[1]*n[4]+e[2]*n[8]+n[12],a[1]=e[0]*n[1]+e[1]*n[5]+e[2]*n[9]+n[13],a[2]=e[0]*n[2]+e[1]*n[6]+e[2]*n[10]+n[14],a}},{key:"_calculateAngle",value:function(e,t,r){for(var n=pa.createVector3(),a=pa.dot3(e,t),i=0;i<3;i++)n[i]=t[i]-a*e[i];var o=pa.createVector3();for(a=pa.dot3(e,r),i=0;i<3;i++)o[i]=r[i]-a*e[i];if(pa.normalize3(n,n),pa.normalize3(o,o),Math.abs(this._getVectorLength(n)<1e-6)||Math.abs(this._getVectorLength(o)<1e-6))s=0;else{var s=Math.acos(pa.clamp(pa.dot3(n,o)/(this._getVectorLength(n)*this._getVectorLength(o)),-1,1))/pa.DEGREE,c=pa.cross3(n,o,pa.createVector3());c=pa.normalize3(c,pa.createVector3()),pa.dot3(e,c)<0&&(s*=-1)}return s}},{key:"_mousePos",value:function(e,t){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}},{key:"startFlyCamera",value:(o=regeneratorRuntime.mark((function e(t){var n,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._viewerCameraMode===r.CameraMode.CAMERA_FREE){e.next=2;break}return e.abrupt("return");case 2:if(t.time&&t.iscs_end){e.next=4;break}return e.abrupt("return");case 4:return this._flycamera_total_time=0,this._flycamera_target_time=t.time,n=this.createFlyCurve(t),this._curve_move=n.move,this._curve_rotation=n.rotation,this._setupAnimationBindingBlock(),this._animation.bind("position",this._updater,this._curve_move),this._animation.bind("orientation",this._updater,this._curve_rotation),this._update_url_hash_backup=this._update_url_hash,this._update_url_hash=!1,this._viewerCameraMode=r.CameraMode.CAMERA_FLY,e.next=17,new Promise((function(e,t){a._flycamera_on_success=e}));case 17:case"end":return e.stop()}}),e,this)})),s=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function i(e){ua(a,r,n,i,s,"next",e)}function s(e){ua(a,r,n,i,s,"throw",e)}i(void 0)}))},function(e){return s.apply(this,arguments)})},{key:"_calculateKeyPoint",value:function(t){var r={fly_iscs_start:t.iscs_start||null,fly_iscs_end:null,target_angle:0,start_top:null,end_top:null,heading:0,tilt:0,roll:0};if(null==t.iscs_start){var n=this._viewer.camera.view_to_gocs;r.fly_iscs_start=(new e.GeoPoint).setFromGocs(e.GeoMath.createVector3([n[12],n[13],n[14]]))}var a=t.end_from_lookat||2e4,i=t.end_altitude||2e4,o=t.target_clamp||!0,s=this._destination(t.iscs_end.longitude,t.iscs_end.latitude,a,0);r.fly_iscs_end=new e.GeoPoint(s.longitude,s.latitude,i);var c=this._viewer.getElevation.bind(this._viewer);c&&(r.fly_iscs_end.altitude+=c(r.fly_iscs_end.latitude,r.fly_iscs_end.longitude));var u=t.iscs_end;c&&o&&(u.altitude=c(u.latitude,u.longitude)),r.target_angle=this._getLookAtAngle(r.fly_iscs_end,u);var l=new e.GeoPoint(r.fly_iscs_start.longitude,r.fly_iscs_start.latitude,0),h=new e.GeoPoint(t.iscs_end.longitude,t.iscs_end.latitude,0),_=l.getGeographicalDistance(h);return _>12e5&&(_=12e5),r.start_top=new e.GeoPoint(r.fly_iscs_start.longitude,r.fly_iscs_start.latitude,r.fly_iscs_end.altitude+_),r.end_top=new e.GeoPoint(r.fly_iscs_end.longitude,r.fly_iscs_end.latitude,r.fly_iscs_end.altitude+_),r.heading=this._camera_parameter.yaw,r.tilt=this._camera_parameter.pitch,r.roll=0,this.setCameraParameter({near:30,far:1e7}),r}},{key:"createFlyCurve",value:function(t){var r=this._calculateKeyPoint(t),n=[],a=[],i=new e.animation.KFLinearCurve(e.animation.Type.find("vector3")),o=new e.animation.KFLinearCurve(e.animation.Type.find("vector3")),s=r.fly_iscs_start,c=r.fly_iscs_end,u=this._flycamera_target_time/3,l=!0;return s.altitude>r.start_top.altitude&&(l=!1),n.push(e.animation.Time.fromNumber(0)),n.push(e.GeoMath.createVector3([s.longitude,s.latitude,s.altitude])),l&&(n.push(e.animation.Time.fromNumber(u)),n.push(e.GeoMath.createVector3([r.start_top.longitude,r.start_top.latitude,r.start_top.altitude])),n.push(e.animation.Time.fromNumber(2*u)),n.push(e.GeoMath.createVector3([r.end_top.longitude,r.end_top.latitude,r.end_top.altitude]))),n.push(e.animation.Time.fromNumber(this._flycamera_target_time)),n.push(e.GeoMath.createVector3([c.longitude,c.latitude,c.altitude])),i.setKeyFrames(n),a.push(e.animation.Time.fromNumber(0)),a.push(e.GeoMath.createVector3([r.heading,r.tilt,r.roll])),l&&(a.push(e.animation.Time.fromNumber(u)),a.push(e.GeoMath.createVector3([r.heading,10,r.roll])),a.push(e.animation.Time.fromNumber(2*u)),a.push(e.GeoMath.createVector3([r.heading,10,r.roll]))),a.push(e.animation.Time.fromNumber(this._flycamera_target_time)),a.push(e.GeoMath.createVector3([r.target_angle.heading,-1*r.target_angle.tilt,this._roll])),o.setKeyFrames(a),{move:i,rotation:o}}},{key:"updateFlyCamera",value:function(t){this._flycamera_total_time+=t,this._updater.update(e.animation.Time.fromNumber(this._flycamera_total_time)),this._flycamera_total_time>=this._flycamera_target_time&&this.onEndFlyCamera()}},{key:"onEndFlyCamera",value:function(){this._animation.unbind("position"),this._animation.unbind("orientation"),this._curve_move=null,this._curve_rotation=null,this._update_url_hash=this._update_url_hash_backup,this._viewerCameraMode=r.CameraMode.CAMERA_FREE,this._resetEventParameter(),this._flycamera_on_success(),this._flycamera_on_success=null}},{key:"_setupAnimationBindingBlock",value:function(){var t=this,r=this._animation,n=e.animation.Type.find("vector3");r.addEntry("position",[n],null,(function(e){t.setCameraPosition({longitude:e[0],latitude:e[1],height:e[2]})})),r.addEntry("orientation",[n],null,(function(e){t._camera_parameter.yaw=e[0],t._camera_parameter.pitch=e[1],t._updateViewerCamera()}))}},{key:"_getLookAtAngle",value:function(e,t){var r=e.getMlocsToGocsMatrix(pa.createMatrix()),n=pa.createVector3([r[4],r[5],r[6]]);n=pa.normalize3(n,pa.createVector3());var a=t.getMlocsToGocsMatrix(pa.createMatrix()),i=pa.createVector3([a[12]-r[12],a[13]-r[13],a[14]-r[14]]);i=pa.normalize3(i,pa.createVector3());var o=pa.createVector3([r[8],r[9],r[10]]),s=this._calculateAngle(o,n,i),c=pa.createVector3([r[8],r[9],r[10]]),u=pa.createVector3([r[0],r[1],r[2]]);return i[0]=-1*i[0],i[1]=-1*i[1],i[2]=-1*i[2],{heading:s,tilt:-1*pa.clamp(Math.abs(this._calculateAngle(u,c,i)),0,90)}}},{key:"_destination",value:function(t,r,n,a){var i=-(180-a)*pa.DEGREE,o=-n*Math.sin(i),s=n*Math.cos(i),c=new e.GeoPoint(t,r,0).getMlocsToGocsMatrix(pa.createMatrix()),u=o*c[0]+s*c[4]+c[12],l=o*c[1]+s*c[5]+c[13],h=o*c[2]+s*c[6]+c[14],_=new e.GeoPoint;return _.setFromGocs([u,l,h]),_}},{key:"viewer",get:function(){return this._viewer}}])&&la(n.prototype,a),i&&la(n,i),r}(e.RenderCallback);return va.OperationMode={NONE:"NONE",TRANSLATE:"TRANSLATE",ROTATE:"ROTATE",FREE_ROTATE:"FREE_ROTATE",EYE_TRANSLATE:"EYE_TRANSLATE",HEIGHT_TRANSLATE:"HEIGHT_TRANSLATE",CHANGE_FOVY:"CHANGE_FOVY"},va.CameraMode={NONE:"NONE",CAMERA_FREE:"CAMERA_FREE",CAMERA_FLY:"CAMERA_FLY"},va.DEFAULT_CAMERA_POSITION={latitude:35.475968,longitude:138.573161,height:2e3},va.DEFAULT_LOOKAT_POSITION={latitude:35.360626,longitude:138.727363,height:2e3},va.DEFAULT_CAMERA_PARAMETER={fov:60,near:30,far:5e5,speed_factor:2e3},va.MINIMUM_HEIGHT=2,va.MINIMUM_NEAR=1,va.MINIMUM_FAR=5e5,va.NEAR_FACTOR=.01,va.FAR_FACTOR=1e4,va.FOV_RANGE={min:5,max:120},va.FOV_FACTOR=1.148698354997035,{StandardUIViewer:va}}));
